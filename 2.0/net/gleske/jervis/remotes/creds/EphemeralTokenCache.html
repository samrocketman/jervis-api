<!--

     Licensed to the Apache Software Foundation (ASF) under one
     or more contributor license agreements.  See the NOTICE file
     distributed with this work for additional information
     regarding copyright ownership.  The ASF licenses this file
     to you under the Apache License, Version 2.0 (the
     "License"); you may not use this file except in compliance
     with the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

     Unless required by applicable law or agreed to in writing,
     software distributed under the License is distributed on an
     "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
     KIND, either express or implied.  See the License for the
     specific language governing permissions and limitations
     under the License.

-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- **************************************************************** -->
<!-- *  PLEASE KEEP COMPLICATED EXPRESSIONS OUT OF THESE TEMPLATES, * -->
<!-- *  i.e. only iterate & print data where possible. Thanks, Jez. * -->
<!-- **************************************************************** -->

<html>
<head>
    <!-- Generated by groovydoc -->
    <title>EphemeralTokenCache (Jervis 2.0 API)</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="../../../../../groovy.ico" type="image/x-icon" rel="shortcut icon">
    <link href="../../../../../groovy.ico" type="image/x-icon" rel="icon">
    <link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
    <link rel="stylesheet" href="../../../../../styles/base16/harmonic16-dark.min.css">
    <script src="../../../../../highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

<body class="center">
<script type="text/javascript"><!--
if (location.href.indexOf('is-external=true') == -1) {
    parent.document.title="EphemeralTokenCache (Jervis 2.0 API)";
}
//-->
</script>
<noscript>
    <div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
    <!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
    <!--   -->
</a>
    <ul class="navList" title="Navigation">
        <li><a href="../../../../../overview-summary.html">Overview</a></li>
        <li><a href="package-summary.html">Package</a></li>
        <li class="navBarCell1Rev">Class</li>
        <li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
        <li><a href="../../../../../index-all.html">Index</a></li>
        <li><a href="../../../../../help-doc.html">Help</a></li>
    </ul>
</div>

<div class="subNav">
    <div>
        <ul class="navList">
            <li><a href="../../../../../index.html?net/gleske/jervis/remotes/creds/EphemeralTokenCache" target="_top">Frames</a></li>
            <li><a href="EphemeralTokenCache.html" target="_top">No Frames</a></li>
        </ul>
    </div>
    <div>
        <ul class="subNavList">
            <li>Summary:&nbsp;</li>
            Nested&nbsp;&nbsp;&nbsp;Field&nbsp;&nbsp;&nbsp;<li><a href="#property_summary">Property</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#constructor_summary">Constructor</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#method_summary">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
        <ul class="subNavList">
            <li>&nbsp;|&nbsp;Detail:&nbsp;</li>
            Field&nbsp;&nbsp;&nbsp;<li><a href="#prop_detail">Property</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#constructor_detail">Constructor</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#method_detail">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
    </div>
    <a name="skip-navbar_top">
        <!--   -->
    </a></div>
<!-- ========= END OF TOP NAVBAR ========= -->

<!-- ======== START OF CLASS DATA ======== -->
<div class="header">

    <div class="subTitle">Package: <strong>net.gleske.jervis.remotes.creds</strong></div>

    <h2 title="[Groovy] Class EphemeralTokenCache" class="title">[Groovy] Class EphemeralTokenCache</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><ul class="inheritance"></ul></li><li>net.gleske.jervis.remotes.creds.EphemeralTokenCache
</ul>
<div class="description">
    <ul class="blockList">
        <li class="blockList">

            <dl>
                <dt>All Implemented Interfaces and Traits:</dt>
                <dd><a href='../../../../../net/gleske/jervis/remotes/interfaces/EphemeralTokenCredential.html'>EphemeralTokenCredential</a>, <a href='../../../../../net/gleske/jervis/remotes/creds/ReadonlyTokenCredential.html'>ReadonlyTokenCredential</a></dd>
            </dl>
            <!-- todo: direct known subclasses -->
            <hr>
            <br>
<pre>class EphemeralTokenCache
extends <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html' title='Object'>Object</a>

</pre>



    <p>
  A flexible token cache with pluggable backend storage which encrypts the
  cache before storing it in the backend.  By default, this uses a Linux file-based
  backend storage; refer to <tt><a href='#cacheFile'>cacheFile</a></tt>.  This is intentionally
  designed for shared use by multiple unrelated token issuers.  This provides
  centralized generic storage for all ephemeral tokens.

  This class, when instantiated, represents a single token which has an expiration
  and automated rotation.  The backend cache is a shared resource amongst many
  unique tokens with expirations.  The purpose is to reduce API calls to 3rd party
  services to request new tokens be issued.  Reuse already issued tokens if they're
  still valid or request a rotation for tokens that have expired.

  <h2>Sample usage</h2>
  <p>To run this example, clone Jervis and execute <tt>./gradlew console</tt>
  to bring up a <a href="http://groovy-lang.org/groovyconsole.html" target="_blank">Groovy Console</a>
  with the classpath set up.</p>

  <p>Basic sample usage using keys on disk for storage.</p>
<pre><code>
import net.gleske.jervis.remotes.creds.EphemeralTokenCache

EphemeralTokenCache tokenCred = new EphemeralTokenCache('src/test/resources/rsa_keys/good_id_rsa_4096')
</code></pre>

  <p>However, ideally you would load the private key from a more secure
  credential backend such as HashiCorp Vault or Jenkins.  The following example
  is for reading the credential from Jenkins.</p>

<pre><code>
import com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey
import com.cloudbees.plugins.credentials.CredentialsProvider
import jenkins.model.Jenkins

import net.gleske.jervis.exceptions.KeyPairDecodeException
import net.gleske.jervis.remotes.creds.EphemeralTokenCache

// Dynamically load an RSA private key from Jenkins.  Key must be 2048-bit or
// greater; 4096-bit recommended.
String credentialId = 'some-credential-id'
EphemeralTokenCache tokenCred = new EphemeralTokenCache({-&gt;
    CredentialsProvider.lookupCredentials(BasicSSHUserPrivateKey, Jenkins.instance, Jenkins.instance.ACL.SYSTEM).find {
        it.id == credentialId
    }.with { jenkinsCred -&gt;
        if(!jenkinsCred?.getPrivateKey()) {
            // Throw an exception because this class will disable encryption if
            // the credential does not exist i.e. returns null
            throw new KeyPairDecodeException("Private key ${credentialId} must not be null.")
        }
        // return private
        jenkinsCred.getPrivateKey()
    }
})
</code></pre>
  </p>

          </li>
    </ul>
</div>

<div class="summary">
    <ul class="blockList">
        <li class="blockList">
        <!-- =========== NESTED CLASS SUMMARY =========== -->
        

        <!-- =========== ENUM CONSTANT SUMMARY =========== -->
        
        <!-- =========== FIELD SUMMARY =========== -->
        

        <!-- =========== PROPERTY SUMMARY =========== -->
        
         <ul class="blockList">
                <li class="blockList"><a name="property_summary"><!--   --></a>
                    <h3>Properties Summary</h3>
                    <ul class="blockList">
                    <table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties Summary table, listing nested classes, and an explanation">
                        <caption><span>Properties</span><span class="tabEnd">&nbsp;</span></caption>
                        <tr>
                            <th class="colFirst" scope="col">Type</th>
                            <th class="colLast" scope="col">Name and description</th>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code><strong><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a></strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#cacheFile">cacheFile</a></code><br>The path to the persistent cache file if this class is initialized with
      encryption at rest.</td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code><strong><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a></strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#cacheLockFile">cacheLockFile</a></code><br>The path to a lock file which serializes read and write access to
      persistent cache where issued tokens are stored.</td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code><strong><a href='http://docs.groovy-lang.org/latest/html/gapi/groovy/lang/Closure.html' title='Closure'>Closure</a></strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#getPrivateKey">getPrivateKey</a></code><br>A closure that returns a PKCS1 or PKCS8 PEM formatted RSA private key as
      a <tt>String</tt> used to encipher the cache for encryption at rest.</td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code><strong><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Integer.html' title='Integer'>Integer</a></strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#hash_iterations">hash_iterations</a></code><br>Customize the number of SHA-256 hash iterations performed during AES
      encryption operations.  </td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code><strong><a href='http://docs.groovy-lang.org/latest/html/gapi/groovy/lang/Closure.html' title='Closure'>Closure</a></strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#loadCache">loadCache</a></code><br>A closure which should return a <tt>String</tt> from loading the cache.
      </td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code><strong><a href='http://docs.groovy-lang.org/latest/html/gapi/groovy/lang/Closure.html' title='Closure'>Closure</a></strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#obtainLock">obtainLock</a></code><br>A centralized lock obtained in order to serialize loading and persisting
      backend cache.  </td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code><strong><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html' title='Long'>Long</a></strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#renew_buffer">renew_buffer</a></code><br>The time buffer before a renewal is forced.  </td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code><strong><a href='http://docs.groovy-lang.org/latest/html/gapi/groovy/lang/Closure.html' title='Closure'>Closure</a></strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#saveCache">saveCache</a></code><br>A closure which which should support a <tt>String</tt> parameter used to
      optionally persist a cache.  </td>
                        </tr>
                        
                    </table>
                   </ul>
                </li>
            </ul>
        

        <!-- =========== ELEMENT SUMMARY =========== -->
        

        
        <!-- ======== CONSTRUCTOR SUMMARY ======== -->
        <ul class="blockList">
                <li class="blockList"><a name="constructor_summary"><!--   --></a>
                    <h3>Constructor Summary</h3>
                    <ul class="blockList">
                    <table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructors Summary table">
                        <caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
                        <tr>
                            <th class="colFirst" scope="col">Constructor and description</th>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst">
                                <code><a href="#EphemeralTokenCache(groovy.lang.Closure)">EphemeralTokenCache</a>
                                (<a href='http://docs.groovy-lang.org/latest/html/gapi/groovy/lang/Closure.html' title='Closure'>Closure</a> resolvePrivateKeyString)</code><br>An ephemeral token cache which provides encryption at rest.  </td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst">
                                <code><a href="#EphemeralTokenCache(java.lang.Boolean)">EphemeralTokenCache</a>
                                (<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Boolean.html' title='Boolean'>Boolean</a> allowEmptyPrivateKey)</code><br>An ephemeral token cache which provides no encryption at rest.  </td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst">
                                <code><a href="#EphemeralTokenCache(java.lang.String)">EphemeralTokenCache</a>
                                (<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> privateKeyPath)</code><br>Creates an encrypted ephemeral token cache from a private key on disk.
      </td>
                        </tr>
                        
                    </table>
                   </ul>
              </li>
        </ul>
        

        
        <!-- ========== METHOD SUMMARY =========== -->
        <ul class="blockList">
            
            <li class="blockList"><a name="method_summary"><!--   --></a>
                    <h3>Methods Summary</h3>
                    <ul class="blockList">
                    <table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Methods Summary table">
                        <caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
                        <tr>
                            <th class="colFirst" scope="col">Type Params</th>
                            <th class="colLast" scope="col">Return Type</th>
                            <th class="colLast" scope="col">Name and description</th>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a></code></td>
                            <td class="colLast"><code><strong><a href="#getExpiration()">getExpiration</a></strong>()</code><br>Gets expiration of the token.</td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html' title='Long'>Long</a></code></td>
                            <td class="colLast"><code><strong><a href="#getRenew_buffer()">getRenew_buffer</a></strong>()</code><br>Returns renew buffer for the current token.</td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a></code></td>
                            <td class="colLast"><code><strong><a href="#getToken()">getToken</a></strong>()</code><br>Gets the access token used for API authentication retrieved from the
      cache.  </td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Boolean.html' title='Boolean'>Boolean</a></code></td>
                            <td class="colLast"><code><strong><a href="#isExpired(java.lang.String)">isExpired</a></strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> hash)</code><br>Checks if a token is expired.</td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Boolean.html' title='Boolean'>Boolean</a></code></td>
                            <td class="colLast"><code><strong><a href="#isExpired()">isExpired</a></strong>()</code><br>Checks if a token is expired.</td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Boolean.html' title='Boolean'>Boolean</a></code></td>
                            <td class="colLast"><code><strong><a href="#isExpired(java.time.Instant)">isExpired</a></strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/Instant.html' title='Instant'>Instant</a> expires)</code><br>Checks if the provided time has passed.</td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code>void</code></td>
                            <td class="colLast"><code><strong><a href="#setCacheFile(java.lang.String)">setCacheFile</a></strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> cacheFile)</code><br>Set cache file location when the cache is saved to local disk.</td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code>void</code></td>
                            <td class="colLast"><code><strong><a href="#setCacheLockFile(java.lang.String)">setCacheLockFile</a></strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> cacheLockFile)</code><br>Set cache lock file location when the cache is saved to local disk.</td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code>void</code></td>
                            <td class="colLast"><code><strong><a href="#setExpiration(java.lang.String)">setExpiration</a></strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> expiration)</code><br>Sets the expiration for a given token.</td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code>void</code></td>
                            <td class="colLast"><code><strong><a href="#setRenew_buffer(java.lang.Long)">setRenew_buffer</a></strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html' title='Long'>Long</a> renew_buffer)</code><br>Sets a renew buffer.  </td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code>void</code></td>
                            <td class="colLast"><code><strong><a href="#updateTokenWith(java.lang.String, java.lang.String, java.lang.String)">updateTokenWith</a></strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> token, <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> expiration, <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> hash)</code><br>A new token has been issued so this method will update the backend cache
      to store the new token.  </td>
                        </tr>
                        
                    </table>
                   </ul>
              </li>
            
            <li class="blockList"><a name="method_summary"><!--   --></a>
                    <h3>Inherited Methods Summary</h3>
                    <ul class="blockList">
                    <table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Inherited Methods Summary table">
                        <caption><span>Inherited Methods</span><span class="tabEnd">&nbsp;</span></caption>
                        <tr>
                            <th class="colFirst" scope="col">Methods inherited from class</th>
                            <th class="colLast" scope="col">Name</th>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code>class <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html' title='Object'>Object</a></code></td>
                            <td class="colLast"><code><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#wait(long)' title='wait'>wait</a>, <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#wait(long, int)' title='wait'>wait</a>, <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#wait()' title='wait'>wait</a>, <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)' title='equals'>equals</a>, <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#toString()' title='toString'>toString</a>, <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#hashCode()' title='hashCode'>hashCode</a>, <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#getClass()' title='getClass'>getClass</a>, <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#notify()' title='notify'>notify</a>, <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#notifyAll()' title='notifyAll'>notifyAll</a></code></td>
                        </tr>
                    </table>
                   </ul>
              </li>
                
        </ul>
        
    </li>
    </ul>
</div>

<div class="details">
    <ul class="blockList">
        <li class="blockList">
           

            

            
            <!-- =========== PROPERTY DETAIL =========== -->
            <ul class="blockList">
                <li class="blockList"><a name="prop_detail">
                    <!--   -->
                </a>
                    <h3>Property Detail</h3>
                    
                        <a name="cacheFile"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> <strong>cacheFile</strong></h4>
                                <p>
      The path to the persistent cache file if this class is initialized with
      encryption at rest.
      <DL><DT><B>Default:</B></DT><DD><tt>/dev/shm/jervis-token-cache.yaml</tt></DD></DL><DL><DT><B>See Also:</B></DT><DD><a href="https://docs.kernel.org/filesystems/tmpfs.html" target=_blank><tt>/dev/shm</tt> filesystem</a> which is in-memory file storage so very fast</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="cacheLockFile"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> <strong>cacheLockFile</strong></h4>
                                <p>
      The path to a lock file which serializes read and write access to
      persistent cache where issued tokens are stored.
      <DL><DT><B>Default:</B></DT><DD><tt>/dev/shm/jervis-token-cache.lock</tt></DD></DL><DL><DT><B>See Also:</B></DT><DD><a href="https://docs.kernel.org/filesystems/tmpfs.html" target=_blank><tt>/dev/shm</tt> filesystem</a> which is in-memory file storage so very fast</DD><DD><a href='#cacheFile'>cacheFile</a></DD><DD><a href='#obtainLock'>obtainLock</a></DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="getPrivateKey"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='http://docs.groovy-lang.org/latest/html/gapi/groovy/lang/Closure.html' title='Closure'>Closure</a> <strong>getPrivateKey</strong></h4>
                                <p>
      A closure that returns a PKCS1 or PKCS8 PEM formatted RSA private key as
      a <tt>String</tt> used to encipher the cache for encryption at rest.

      <h2>Sample usage</h2>

      <p>This assumes a private key is insecurely stored as a file.  Ideally,
      the private key is stored in a 3rd party credentials backend.</p>

<pre><code>
import net.gleske.jervis.remotes.creds.EphemeralTokenCache

// instantiates getPrivateKey for you
EphemeralTokenCache cred = new EphemeralTokenCache({-&gt; new File('path/to/private_key').text })

// alternately you can manually set it
cred.getPrivateKey = {-&gt; new File('path/to/private_key').text }
</pre></code>
      <DL><DT><B>See Also:</B></DT><DD><a href='../../../../../net/gleske/jervis/tools/CipherMap.html' title='CipherMap provides encryption at rest'>CipherMap provides encryption at rest</a></DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="hash_iterations"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Integer.html' title='Integer'>Integer</a> <strong>hash_iterations</strong></h4>
                                <p>
      Customize the number of SHA-256 hash iterations performed during AES
      encryption operations.  Due to encryption strength, <tt>CipherMap</tt>
      automatically rotating keys, and the short-lived nature of the ephemeral
      tokens this value is lowered from the <tt>DEFAULT_AES_ITERATIONS</tt>.
      <DL><DT><B>Default:</B></DT><DD>0</DD></DL><DL><DT><B>See Also:</B></DT><DD><a href='../../../../../net/gleske/jervis/tools/SecurityIO.html#DEFAULT_AES_ITERATIONS' title='SecurityIO.DEFAULT_AES_ITERATIONS'>SecurityIO.DEFAULT_AES_ITERATIONS</a></DD><DD><a href='../../../../../net/gleske/jervis/tools/CipherMap.html' title='CipherMap provides encryption at rest'>CipherMap provides encryption at rest</a></DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="loadCache"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='http://docs.groovy-lang.org/latest/html/gapi/groovy/lang/Closure.html' title='Closure'>Closure</a> <strong>loadCache</strong></h4>
                                <p>
      A closure which should return a <tt>String</tt> from loading the cache.
      Persistent caching of tokens is optional.  Before this is called a file
      lock is obtained on a lock file.
      <DL><DT><B>Default:</B></DT><DD><pre><code>
{-&gt;
    File f = new File(this.cacheFile)
    if(!f.exists()) {
        return ''
    }
    f.text
}
</code></pre></DD></DL><DL><DT><B>See Also:</B></DT><DD><a href='#cacheFile'>cacheFile</a></DD><DD><a href='#cacheLockFile'>cacheLockFile</a></DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="obtainLock"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='http://docs.groovy-lang.org/latest/html/gapi/groovy/lang/Closure.html' title='Closure'>Closure</a> <strong>obtainLock</strong></h4>
                                <p>
      A centralized lock obtained in order to serialize loading and persisting
      backend cache.  Since the backend cache is file-based, this lock is also
      file-based by default.  You can replace the default with a distributed
      lock.
      <DL><DT><B>Default:</B></DT><DD><pre><code>
{ Closure body -&gt;
    new LockableFile(this.cacheLockFile).withLock {
        body()
    }
}
</code></pre></DD></DL><DL><DT><B>See Also:</B></DT><DD><a href='#cacheLockFile'>cacheLockFile</a></DD><DD><a href='../../../../../net/gleske/jervis/tools/LockableFile.html' title='LockableFile'>LockableFile</a></DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="renew_buffer"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html' title='Long'>Long</a> <strong>renew_buffer</strong></h4>
                                <p>
      The time buffer before a renewal is forced.  This is to account for clock
      drift and is customizable by the client.  The value is number of seconds.
      <DL><DT><B>Default:</B></DT><DD>30</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="saveCache"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='http://docs.groovy-lang.org/latest/html/gapi/groovy/lang/Closure.html' title='Closure'>Closure</a> <strong>saveCache</strong></h4>
                                <p>
      A closure which which should support a <tt>String</tt> parameter used to
      optionally persist a cache.  Before this is called a file lock is obtained on a lock file.
      <DL><DT><B>Default:</B></DT><DD><pre><code>
{ String cache -&gt;
    File f = new File(this.cacheFile)
    // initialize file with private permissions
    if(!f.exists()) {
        ['/bin/sh', '-ec', "touch '&#36;{this.cacheFile}'; chmod 600 '&#36;{this.cacheFile}'"].execute()
    }
    // write out cache
    f.withWriter('UTF-8') { Writer w -&gt;
        w &lt;&lt; cache
    }
}
</code></pre></DD></DL><DL><DT><B>See Also:</B></DT><DD><a href='#cacheFile'>cacheFile</a></DD><DD><a href='#cacheLockFile'>cacheLockFile</a></DD></DL></p>
                            </li>
                        </ul>
                    
                </li>
            </ul>
            

            

            
            <!-- =========== CONSTRUCTOR DETAIL =========== -->
            <ul class="blockList">
                <li class="blockList"><a name="constructor_detail">
                    <!--   -->
                </a>
                    <h3>Constructor Detail</h3>
                    
                        <a name="EphemeralTokenCache(groovy.lang.Closure)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><strong>EphemeralTokenCache</strong>(<a href='http://docs.groovy-lang.org/latest/html/gapi/groovy/lang/Closure.html' title='Closure'>Closure</a> resolvePrivateKeyString)</h4>
                                <p>
      An ephemeral token cache which provides encryption at rest.  A dynamic
      resolution of the private key from a 3rd party credential backend is the
      intention of this constructor.
      <DL><DT><B>See Also:</B></DT><DD><a href='../../../../../net/gleske/jervis/tools/CipherMap.html' title='CipherMap provides encryption at rest'>CipherMap provides encryption at rest</a></DD><DD><a href='#getPrivateKey'>Instantiates getPrivateKey closure</a></DD><DD><a href='#loadCache'>Instantiates loadCache closure</a></DD><DD><a href='#obtainLock'>Instantiates obtainLock closure</a></DD><DD><a href='#saveCache'>Instantiates saveCache closure</a></DD><DD><a href='../../../../../net/gleske/jervis/exceptions/TokenException.html' title='TokenException'>TokenException</a></DD></DL><DL><DT><B>Parameters:</B></DT><DD><code>resolvePrivateKeyString</code> -  An executable <tt>Closure</tt> that takes
                                     no parameters and returns a PKCS1 or PKCS8
                                     PEM formatted RSA private key.  If this
                                     ever returns null or empty string, then a
                                     <tt>TokenException</tt> will be thrown.</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="EphemeralTokenCache(java.lang.Boolean)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><strong>EphemeralTokenCache</strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Boolean.html' title='Boolean'>Boolean</a> allowEmptyPrivateKey)</h4>
                                <p>
      An ephemeral token cache which provides no encryption at rest.  If using
      this, then you should update the <tt>loadCache</tt> and <tt>saveCache</tt>
      closures to use something other than a file-based backend.<DL><DT><B>Warning:</B></DT><DD>Encryption at rest is disabled.  This is intended to provide
               flexibility.  The cache entries contain sensitive API tokens and
               should be encrypted at rest; if not encrypted by
               <tt>CipherMap</tt>, then encrypted by the backend service.</DD></DL>
      <DL><DT><B>See Also:</B></DT><DD><a href='#EphemeralTokenCache(groovy.lang.Closure)'>EphemeralTokenCache(groovy.lang.Closure)</a></DD><DD><a href='#loadCache'>Instantiates loadCache closure</a></DD><DD><a href='#saveCache'>Instantiates saveCache closure</a></DD><DD><a href='../../../../../net/gleske/jervis/exceptions/TokenException.html' title='TokenException'>TokenException</a></DD></DL><DL><DT><B>Parameters:</B></DT><DD><code>allowEmptyPrivateKey</code> -  Uses a plain text cache if <tt>true</tt>.  It
                                  will throw a <tt>TokenException</tt> if
                                  <tt>false</tt>.</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="EphemeralTokenCache(java.lang.String)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><strong>EphemeralTokenCache</strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> privateKeyPath)</h4>
                                <p>
      Creates an encrypted ephemeral token cache from a private key on disk.
      This assumes a private key is insecurely stored on disk if no 3rd party
      credential backend is used.

      <p>This constructor is provided for convenience and is equavalent to the
      following closure constructor.</p>

<pre><code>
new EphemeralTokenCache({-&gt; new File(privateKeyPath).text })
</code></pre><DL><DT><B>Warning:</B></DT><DD>Because the private key is insecurely stored on disk this is not
               truly encryption at rest.  Encryption at rest requires the
               decryption keys are not immediately available in plain form.
               This constructor is intended to ease testing and provide an easy
               way to experiment with the class interactively.</DD></DL>
      <DL><DT><B>See Also:</B></DT><DD><a href='#EphemeralTokenCache(groovy.lang.Closure)'>EphemeralTokenCache(groovy.lang.Closure)</a></DD></DL><DL><DT><B>Parameters:</B></DT><DD><code>resolvePrivateKeyString</code> -  Path to a file which contains a PKCS1 or
                                     PKCS8 PEM formatted RSA private key.</DD></DL></p>
                            </li>
                        </ul>
                    
                </li>
            </ul>
            


            
            <!-- =========== METHOD DETAIL =========== -->
            <ul class="blockList">
                <li class="blockList"><a name="method_detail">
                    <!--   -->
                </a>
                    <h3>Method Detail</h3>
                    
                        <a name="getExpiration()"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> <strong>getExpiration</strong>()</h4>
                                <p>
      Gets expiration of the token.
      </p>
                            </li>
                        </ul>
                    
                        <a name="getRenew_buffer()"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html' title='Long'>Long</a> <strong>getRenew_buffer</strong>()</h4>
                                <p>
      Returns renew buffer for the current token.
      <DL><DT><B>See Also:</B></DT><DD><a href='#renew_buffer'>renew_buffer</a></DD></DL><DL><DT><B>Returns:</B></DT><DD><tt>0</tt> or a <tt>renew_buffer</tt> greater than <tt>0</tt>.</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="getToken()"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> <strong>getToken</strong>()</h4>
                                <p>
      Gets the access token used for API authentication retrieved from the
      cache.  Before calling this, you must call <tt>isExpired</tt> or
      <tt>updateTokenWith</tt> method first otherwise <tt>null</tt> will be
      returned.
      <DL><DT><B>See Also:</B></DT><DD><a href='#isExpired(java.lang.String)'>isExpired(java.lang.String)</a></DD><DD><a href='#updateTokenWith(java.lang.String, java.lang.String, java.lang.String)'>updateTokenWith(java.lang.String, java.lang.String, java.lang.String)</a></DD></DL><DL><DT><B>Returns:</B></DT><DD>Returns a valid API token meant to be used in authentication.</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="isExpired(java.lang.String)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Boolean.html' title='Boolean'>Boolean</a> <strong>isExpired</strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> hash)</h4>
                                <p>
      Checks if a token is expired.
      <DL><DT><B>See Also:</B></DT><DD><a href='#getRenew_buffer()'>getRenew_buffer()</a></DD><DD><a href='#isExpired(java.time.Instant)'>isExpired(java.time.Instant)</a></DD></DL><DL><DT><B>Parameters:</B></DT><DD><code>hash</code> -  A hash used for performing a lookup on an internal token
                  cache.</DD></DL><DL><DT><B>Returns:</B></DT><DD>Returns <tt>true</tt> if the issued token is expired requiring
              another to be issued.</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="isExpired()"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Boolean.html' title='Boolean'>Boolean</a> <strong>isExpired</strong>()</h4>
                                <p>
      Checks if a token is expired.
      <DL><DT><B>See Also:</B></DT><DD><a href='#getRenew_buffer()'>getRenew_buffer()</a></DD><DD><a href='#isExpired(java.time.Instant)'>isExpired(java.time.Instant)</a></DD></DL><DL><DT><B>Returns:</B></DT><DD>Returns <tt>true</tt> if the issued token is expired requiring
              another to be issued.</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="isExpired(java.time.Instant)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Boolean.html' title='Boolean'>Boolean</a> <strong>isExpired</strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/Instant.html' title='Instant'>Instant</a> expires)</h4>
                                <p>
      Checks if the provided time has passed.
      <DL><DT><B>See Also:</B></DT><DD><a href='#getRenew_buffer()'>getRenew_buffer()</a></DD><DD><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/Instant.html#now()' title='Instant.now'>Instant.now</a></DD></DL><DL><DT><B>Parameters:</B></DT><DD><code>expires</code> -  Check if this instant is expired based on
                     <tt>getRenew_buffer()</tt> and <tt>Instant.now</tt>.</DD></DL><DL><DT><B>Returns:</B></DT><DD>Returns <tt>true</tt> if the GitHub token is expired requiring
              another to be issued.</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="setCacheFile(java.lang.String)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>void <strong>setCacheFile</strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> cacheFile)</h4>
                                <p>
      Set cache file location when the cache is saved to local disk.
      <DL><DT><B>See Also:</B></DT><DD><a href='#cacheFile'>cacheFile</a></DD></DL><DL><DT><B>Parameters:</B></DT><DD><code>cacheFile</code> -  A local filesystem path to a YAML file.  The contents
                       will be YAML.</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="setCacheLockFile(java.lang.String)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>void <strong>setCacheLockFile</strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> cacheLockFile)</h4>
                                <p>
      Set cache lock file location when the cache is saved to local disk.
      <DL><DT><B>See Also:</B></DT><DD><a href='#cacheLockFile'>cacheLockFile</a></DD></DL><DL><DT><B>Parameters:</B></DT><DD><code>cacheLockFile</code> -  A local filesystem path to a file.  This will be used
                           for file locking to serialize reading and updating
                           the local <tt><a href='#cacheFile'>cacheFile</a></tt>.</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="setExpiration(java.lang.String)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>void <strong>setExpiration</strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> expiration)</h4>
                                <p>
      Sets the expiration for a given token.
      <DL><DT><B>See Also:</B></DT><DD><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/Instant.html#toString()' title='Instant.toString'>Instant.toString</a></DD><DD><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/format/DateTimeParseException.html' title='DateTimeParseException'>DateTimeParseException</a></DD></DL><DL><DT><B>Parameters:</B></DT><DD><code>expiration</code> -  An ISO instant formatted string like
                        <tt>Instant.toString</tt>.</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="setRenew_buffer(java.lang.Long)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>void <strong>setRenew_buffer</strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html' title='Long'>Long</a> renew_buffer)</h4>
                                <p>
      Sets a renew buffer.  Does not allow renew buffer to be undefined or go below zero.
      </p>
                            </li>
                        </ul>
                    
                        <a name="updateTokenWith(java.lang.String, java.lang.String, java.lang.String)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>void <strong>updateTokenWith</strong>(<a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> token, <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> expiration, <a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> hash)</h4>
                                <p>
      A new token has been issued so this method will update the backend cache
      to store the new token.  This method will also remove expired tokens
      before persisting the cache.
      <DL><DT><B>See Also:</B></DT><DD><a href='#getRenew_buffer()'>getRenew_buffer()</a></DD><DD><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/format/DateTimeParseException.html' title='DateTimeParseException'>DateTimeParseException</a></DD></DL></p>
                            </li>
                        </ul>
                    
                </li>
            </ul>
            
        </li>
    </ul>
</div>

<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
    <!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
    <!--   -->
</a>
    <ul class="navList" title="Navigation">
        <li><a href="../../../../../overview-summary.html">Overview</a></li>
        <li><a href="package-summary.html">Package</a></li>
        <li class="navBarCell1Rev">Class</li>
        <li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
        <li><a href="../../../../../index-all.html">Index</a></li>
        <li><a href="../../../../../help-doc.html">Help</a></li>
    </ul>
</div>

<div class="subNav">
    <div>
        <ul class="navList">
            <li><a href="../../../../../index.html?net/gleske/jervis/remotes/creds/EphemeralTokenCache" target="_top">Frames</a></li>
            <li><a href="EphemeralTokenCache.html" target="_top">No Frames</a></li>
        </ul>
    </div>
    <div>
        <ul class="subNavList">
            <li>Summary:&nbsp;</li>
            Nested&nbsp;&nbsp;&nbsp;Field&nbsp;&nbsp;&nbsp;<li><a href="#property_summary">Property</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#constructor_summary">Constructor</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#method_summary">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
        <ul class="subNavList">
            <li>&nbsp;|&nbsp;Detail:&nbsp;</li>
            Field&nbsp;&nbsp;&nbsp;<li><a href="#prop_detail">Property</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#constructor_detail">Constructor</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#method_detail">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
    </div>
    <p><a href="https://github.com/samrocketman/jervis" target="_blank">Jervis</a> API documentation.</p>
    <a name="skip-navbar_bottom">
        <!--   -->
    </a>
    </div>
</div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
