<!--

     Licensed to the Apache Software Foundation (ASF) under one
     or more contributor license agreements.  See the NOTICE file
     distributed with this work for additional information
     regarding copyright ownership.  The ASF licenses this file
     to you under the Apache License, Version 2.0 (the
     "License"); you may not use this file except in compliance
     with the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

     Unless required by applicable law or agreed to in writing,
     software distributed under the License is distributed on an
     "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
     KIND, either express or implied.  See the License for the
     specific language governing permissions and limitations
     under the License.

-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- **************************************************************** -->
<!-- *  PLEASE KEEP COMPLICATED EXPRESSIONS OUT OF THESE TEMPLATES, * -->
<!-- *  i.e. only iterate & print data where possible. Thanks, Jez. * -->
<!-- **************************************************************** -->

<html>
<head>
    <!-- Generated by groovydoc -->
    <title>VaultRoleIdCredential (Jervis 2.0 API)</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="../../../../../groovy.ico" type="image/x-icon" rel="shortcut icon">
    <link href="../../../../../groovy.ico" type="image/x-icon" rel="icon">
    <link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
    <link rel="stylesheet" href="../../../../../styles/base16/harmonic16-dark.min.css">
    <script src="../../../../../highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

<body class="center">
<script type="text/javascript"><!--
if (location.href.indexOf('is-external=true') == -1) {
    parent.document.title="VaultRoleIdCredential (Jervis 2.0 API)";
}
//-->
</script>
<noscript>
    <div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
    <!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
    <!--   -->
</a>
    <ul class="navList" title="Navigation">
        <li><a href="../../../../../overview-summary.html">Overview</a></li>
        <li><a href="package-summary.html">Package</a></li>
        <li class="navBarCell1Rev">Class</li>
        <li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
        <li><a href="../../../../../index-all.html">Index</a></li>
        <li><a href="../../../../../help-doc.html">Help</a></li>
    </ul>
</div>

<div class="subNav">
    <div>
        <ul class="navList">
            <li><a href="../../../../../index.html?net/gleske/jervis/remotes/interfaces/VaultRoleIdCredential" target="_top">Frames</a></li>
            <li><a href="VaultRoleIdCredential.html" target="_top">No Frames</a></li>
        </ul>
    </div>
    <div>
        <ul class="subNavList">
            <li>Summary:&nbsp;</li>
            Nested&nbsp;&nbsp;&nbsp;Field&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<li><a href="#method_summary">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
        <ul class="subNavList">
            <li>&nbsp;|&nbsp;Detail:&nbsp;</li>
            Field&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<li><a href="#method_detail">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
    </div>
    <a name="skip-navbar_top">
        <!--   -->
    </a></div>
<!-- ========= END OF TOP NAVBAR ========= -->

<!-- ======== START OF CLASS DATA ======== -->
<div class="header">

    <div class="subTitle">Package: <strong>net.gleske.jervis.remotes.interfaces</strong></div>

    <h2 title="[Groovy] Interface VaultRoleIdCredential" class="title">[Groovy] Interface VaultRoleIdCredential</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><ul class="inheritance"></ul></li><li>net.gleske.jervis.remotes.interfaces.JervisCredential
</ul>
<div class="description">
    <ul class="blockList">
        <li class="blockList">

            <dl>
                <dt>All Superinterfaces:</dt>
                <dd><a href='../../../../../net/gleske/jervis/remotes/interfaces/JervisCredential.html'>JervisCredential</a></dd>
            </dl>

    <p>
  A basic credential whose only purpose is to get a Role ID and Secret ID for
  <a href="https://developer.hashicorp.com/vault/docs/auth/approle" target=_blank>HashiCorp Vault AppRole</a>
  authentication.

  <h2>Sample usage</h2>
  <p>To run this example, clone Jervis and execute <tt>./gradlew console</tt>
  to bring up a <a href="http://groovy-lang.org/groovyconsole.html" target="_blank">Groovy Console</a>
  with the classpath set up.</p>

<pre><code>
import net.gleske.jervis.remotes.interfaces.VaultRoleIdCredential


// A file-based backend where the file has 'role_id:secret_id' as its content.
VaultRoleIdCredential roleid = [
    getRole_id: {-> new File('somefile').text.trim().tokenize(':')[0]},
    getSecret_id: {-> new File('somefile').text.trim().tokenize(':')[1]}
] as VaultRoleIdCredential
</pre></code>

  <p>Let's say you have a need to not store the role ID and secret ID in Java
  memory except for when it is used.  The following is a hypothetical example.
  A third example will be provided as a real world example.</p>

<pre><code>
import net.gleske.jervis.remotes.interfaces.VaultRoleIdCredential

class FileRoleId implements VaultRoleIdCredential {
    final File file
    private void validateFile() {
        if(!this.file.exists()) {
            throw new java.io.FileNotFoundException("${path} does not exist.")
        }
        this.file.text.trim().with { String contents ->
            if(!(contents.count(':') == 1)) {
                throw new IOException("${this.file} must contain role_id:secret_id as its contents.")
            }
        }
    }
    FileRoleId(String path) {
        this.file = new File(path)
        validateFile()
    }
    String getRole_id() {
        this.file.text.trim().tokenize(':')[0]
    }
    String getSecret_id() {
        this.file.text.trim().tokenize(':')[1]
    }
}

// A file-based backend where the file has 'role_id:secret_id' as its content.
VaultRoleIdCredential roleid = new FileRoleId('somefile')
</code></pre>

  <p>Secrets might be stored elsewhere like AWS secrets manager or in the case
  of Jenkins, a Jenkins credential store.  It is beneficial to rely on the
  secure store to keep the credential secured.  In this case, we only want to
  retrieve the credential when we need it and not actually store it.</p>

<pre><code>
import net.gleske.jervis.remotes.interfaces.VaultRoleIdCredential

import com.cloudbees.plugins.credentials.CredentialsProvider
import com.cloudbees.plugins.credentials.common.StandardUsernamePasswordCredentials
import jenkins.model.Jenkins
import hudson.model.Item

class JenkinsRoleIdCredential implements VaultRoleIdCredential {
    private final Item owner
    private final String credentialsId
    private StandardUsernamePasswordCredentials getCredential() {
        CredentialsProvider.lookupCredentials(StandardUsernamePasswordCredentials, this.owner, Jenkins.instance.ACL.SYSTEM).find {
            it.id == this.credentialsId
        }
    }
    private void validate() {
        if(this.getCredential() == null) {
            throw new IOException("Jenkins username and password credential ID '${credentialsId}' does not exist.")
        }
    }
    JenkinsRoleIdCredential(Item owner, String credentialsId) {
        this.owner = owner
        this.credentialsId = credentialsId
        validate()
    }
    String getRole_id() {
        this.getCredential().getUsername()
    }
    String getSecret_id() {
        this.getCredential().getPassword()?.getPlainText()
    }
}

// A Jenkins credentials backend where the credential has role ID as its user and secret ID as its password.
VaultRoleIdCredential roleid = new JenkinsRoleIdCredential(Jenkins.instance, 'some-credential-id')
</code></pre>

  <p>Given the above Jenkins credential, you can initialize <tt><a href='../../../../../net/gleske/jervis/remotes/VaultService.html' title='VaultService'>VaultService</a></tt>
  communication by setting up the client with the secured <tt><a href='../../../../../net/gleske/jervis/remotes/creds/VaultAppRoleCredential.html' title='VaultAppRoleCredential'>VaultAppRoleCredential</a></tt>
  authentication.</p>

<pre><code>
import net.gleske.jervis.remotes.VaultService
import net.gleske.jervis.remotes.creds.VaultAppRoleCredential
import jenkins.model.Jenkins
// import JenkinsRoleIdCredential

JenkinsRoleIdCredential roleid = new JenkinsRoleIdCredential(Jenkins.instance, 'some-credential-id')
VaultAppRoleCredential approle = new VaultAppRoleCredential('https://vault.example.com', roleid)
VaultService vault = new VaultService(approle)

// set secrets mount versions
vault.mountVersions = [kv: 2]

// ready to perform secrets operations
vault.getSecret('kv/path/to/secret')
</pre></code>

  <p>The above example will use approle to issue ephemeral vault tokens which
  automatically rotate as the client is making requests.</p>
  </p>

          </li>
    </ul>
</div>

<div class="summary">
    <ul class="blockList">
        <li class="blockList">
        <!-- =========== NESTED CLASS SUMMARY =========== -->
        

        <!-- =========== ENUM CONSTANT SUMMARY =========== -->
        
        <!-- =========== FIELD SUMMARY =========== -->
        

        <!-- =========== PROPERTY SUMMARY =========== -->
        

        <!-- =========== ELEMENT SUMMARY =========== -->
        

        

        
        <!-- ========== METHOD SUMMARY =========== -->
        <ul class="blockList">
            
            <li class="blockList"><a name="method_summary"><!--   --></a>
                    <h3>Methods Summary</h3>
                    <ul class="blockList">
                    <table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Methods Summary table">
                        <caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
                        <tr>
                            <th class="colFirst" scope="col">Type Params</th>
                            <th class="colLast" scope="col">Return Type</th>
                            <th class="colLast" scope="col">Name and description</th>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a></code></td>
                            <td class="colLast"><code><strong><a href="#getRole_id()">getRole_id</a></strong>()</code><br>When implemented, this method should return a role ID used for
      authenticating with Vault.</td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a></code></td>
                            <td class="colLast"><code><strong><a href="#getSecret_id()">getSecret_id</a></strong>()</code><br>When implemented, this method should return a secret ID used for
      authenticating with Vault.</td>
                        </tr>
                        
                    </table>
                   </ul>
              </li>
            
        </ul>
        
    </li>
    </ul>
</div>

<div class="details">
    <ul class="blockList">
        <li class="blockList">
           

            

            

            

            


            
            <!-- =========== METHOD DETAIL =========== -->
            <ul class="blockList">
                <li class="blockList"><a name="method_detail">
                    <!--   -->
                </a>
                    <h3>Method Detail</h3>
                    
                        <a name="getRole_id()"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> <strong>getRole_id</strong>()</h4>
                                <p>
      When implemented, this method should return a role ID used for
      authenticating with Vault.
      </p>
                            </li>
                        </ul>
                    
                        <a name="getSecret_id()"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><a href='https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html' title='String'>String</a> <strong>getSecret_id</strong>()</h4>
                                <p>
      When implemented, this method should return a secret ID used for
      authenticating with Vault.
      </p>
                            </li>
                        </ul>
                    
                </li>
            </ul>
            
        </li>
    </ul>
</div>

<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
    <!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
    <!--   -->
</a>
    <ul class="navList" title="Navigation">
        <li><a href="../../../../../overview-summary.html">Overview</a></li>
        <li><a href="package-summary.html">Package</a></li>
        <li class="navBarCell1Rev">Class</li>
        <li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
        <li><a href="../../../../../index-all.html">Index</a></li>
        <li><a href="../../../../../help-doc.html">Help</a></li>
    </ul>
</div>

<div class="subNav">
    <div>
        <ul class="navList">
            <li><a href="../../../../../index.html?net/gleske/jervis/remotes/interfaces/VaultRoleIdCredential" target="_top">Frames</a></li>
            <li><a href="VaultRoleIdCredential.html" target="_top">No Frames</a></li>
        </ul>
    </div>
    <div>
        <ul class="subNavList">
            <li>Summary:&nbsp;</li>
            Nested&nbsp;&nbsp;&nbsp;Field&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<li><a href="#method_summary">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
        <ul class="subNavList">
            <li>&nbsp;|&nbsp;Detail:&nbsp;</li>
            Field&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<li><a href="#method_detail">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
    </div>
    <p><a href="https://github.com/samrocketman/jervis" target="_blank">Jervis</a> API documentation.</p>
    <a name="skip-navbar_bottom">
        <!--   -->
    </a>
    </div>
</div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
